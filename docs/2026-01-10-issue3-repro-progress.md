# 2026-01-10: issue #3 (vhost_worker_killed) repro progress

This note captures what was done today so we can resume quickly later.

Target issue:
- extid: `a9528028ab4ca83e8bac`
- bug page: https://syzkaller.appspot.com/bug?extid=a9528028ab4ca83e8bac

## Status at end of day

- We can boot the syzbot-provided kernel+disk in QEMU using the local bundle.
- The missing piece earlier was obtaining `syz-execprog` + `syz-executor` binaries to run `repro.syz`.
- Those binaries are now built on the host (see below).

## Key files/directories

- Repro bundle (ignored by git):
  - `repro/a9528028ab4ca83e8bac/`
  - Contains `bzImage`, `disk.raw`, `repro.syz`, `run_qemu.sh`, logs.
- Syzkaller checkout (host):
  - `/home/oldzhu/mylinux/syzkaller/`

## QEMU runner improvements

The QEMU runner is generated by:
- `tools/syzbot_prepare_qemu_repro.py`

`run_qemu.sh` now supports two optional quality-of-life features:

1) **Daemonized VM (keep your terminal)**
- `DAEMONIZE=1 ./run_qemu.sh`
- Writes serial output to `qemu-serial.log` and PID to `qemu.pid`.

2) **Optional hostâ†”guest shared folder (9p)**
- `SHARE_DIR=$PWD SHARE_MOUNT=/mnt/host ./run_qemu.sh`
- Mount inside guest:
  - `mkdir -p /mnt/host`
  - `mount -t 9p -o trans=virtio,version=9p2000.L hostshare /mnt/host`

This is useful for copying `syz-execprog`/`syz-executor` into the VM without relying on SSH.

## Syzkaller runner binaries (host-side)

APT did not expose a `syzkaller` package on this system, so we built from source.

### 1) Clone syzkaller

- Checkout location: `/home/oldzhu/mylinux/syzkaller`

We used a shallow clone with reduced blob transfer to handle flaky networking.

### 2) Go toolchain requirement

The syzkaller tree we pulled specifies:
- `go 1.24.4` in `go.mod`

Host Go was:
- `go1.22.2`

So we downloaded a local Go toolchain (no system-wide replacement):
- Installed at: `/home/oldzhu/.local/go1.24.4/go/bin/go`

### 3) Build the two binaries we need

Binaries produced:
- `/home/oldzhu/mylinux/syzkaller/bin/linux_amd64/syz-execprog`
- `/home/oldzhu/mylinux/syzkaller/bin/linux_amd64/syz-executor`

We built `syz-execprog` directly via:
- `GOOS=linux GOARCH=amd64 go build ... github.com/google/syzkaller/tools/syz-execprog`

And built `syz-executor` via `make execprog executor` (executor is a C++ build).

Note:
- `make` may try to download additional cloud/dashboard deps for other tools; for our purposes we only need these two binaries.

## Next steps (when resuming)

1) Boot the VM with a shared folder:
- `cd repro/a9528028ab4ca83e8bac`
- `SHARE_DIR=/home/oldzhu/mylinux SHARE_MOUNT=/mnt/host DAEMONIZE=1 ./run_qemu.sh`

2) In the guest, mount the share and run the repro:
- `mount -t 9p -o trans=virtio,version=9p2000.L hostshare /mnt/host`
- Copy binaries into a writable dir (e.g. `/root/repro`) and run:
  - `./syz-execprog -executor=./syz-executor -sandbox=none -procs=6 -threaded=1 -repeat=0 repro.syz`

3) Capture reproduction evidence:
- `dmesg -wT`
- `echo t > /proc/sysrq-trigger` when it hangs

Reference repro expectations:
- `docs/repro-syzbot-issue3-vhost-worker-killed.md`
