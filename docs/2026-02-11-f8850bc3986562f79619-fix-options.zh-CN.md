# f8850bc3986562f79619: taprio RCU stall 修复方案

本文档记录 TAPRIO (sch_taprio) 计时器“追赶风暴”的两种候选修复方案。

## 方案 1：软件模式最小间隔限制

- 适用范围：仅软件模式（非 full offload、非 txtime-assist）。
- 改动：在 netlink 解析阶段增加更严格的最小 schedule interval。
- 行为：拒绝过小的 interval（例如 255 ns）。
- 理由：软件调度无法可靠处理亚微秒级别间隔，容易触发 hrtimer 风暴。

补丁：repro/f8850bc3986562f79619/patches/option1-min-interval.patch

## 方案 2：advance_sched() 追赶重同步

- 适用范围：软件计时器调度的运行时行为。
- 改动：当定时器触发时已落后于当前时间，重新定位到“当前时刻”对应的 entry，并设置下一次未来边界。
- 行为：避免将 hrtimer 重新设置到过去时间点，从而防止紧密循环。
- 理由：允许较小 interval，但限制“追赶”行为，避免 CPU 被连续重触发占用。

补丁：repro/f8850bc3986562f79619/patches/option2-catch-up.patch

## 备注

- 两个方案互斥，可独立评估。
- 方案 1 属于输入校验，方案 2 属于运行时防护。
