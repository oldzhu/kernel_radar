# Local build fragment for issue #3 repro A/B testing
# Goal: enable lockdep + tracing (trace_printk) and reduce unrelated noise.

# Lockdep / locking diagnostics
CONFIG_LOCKDEP=y
CONFIG_PROVE_LOCKING=y
CONFIG_DEBUG_LOCK_ALLOC=y
CONFIG_DEBUG_MUTEXES=y
CONFIG_LOCK_STAT=y

# Tracing (needed for trace_printk + ftrace_dump_on_oops)
CONFIG_TRACING=y
CONFIG_TRACEPOINTS=y
CONFIG_FTRACE=y

# Work around rare breakpoint/int3 traps seen in __kmalloc_cache_noprof at
# arch_static_branch sites (jump labels). Disabling jump labels trades some
# performance for stability in this repro VM.
CONFIG_JUMP_LABEL=n

# KASAN is great but in this guest image it can crash early during boot,
# preventing the repro from running. Prefer lockdep+tracing here.
CONFIG_KASAN=n

# Avoid requiring libdw development headers on the build host.
CONFIG_GENDWARFKSYMS=n

# Reduce unrelated filesystem noise
CONFIG_NILFS2_FS=n

# Avoid unrelated netdevsim WARN/oops loops that can panic the VM
# (seen in workqueue: events_unbound nsim_dev_trap_report_work).
CONFIG_NETDEVSIM=n
